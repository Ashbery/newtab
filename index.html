<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ashbery æ–°åˆ†é </title>
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="favicon.ico">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            color: white;
            overflow: hidden;
            height: 100vh;
            background: #000;
        }

        #video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        .overlay {
            display: none;
        }

        .header-container {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .time-container {
            flex-shrink: 0;
            min-width: 200px;
        }

        .clock {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-variant-numeric: tabular-nums;
        }

        .date {
            font-size: 0.8rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .search-container {
            flex: 1;
            max-width: 600px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.15);
            font-size: 1rem;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            outline: none;
            text-align: left;
        }

        .search-input:focus {
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.8);
            text-align: left;
        }

        /* å³ä¸Šè§’å¿«æ·éµ */
        .quick-links {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .quick-link {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .quick-link:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* å³ä¸Šè§’ Google ç™»å…¥æŒ‰éˆ• - ä½¿ç”¨ç¶²ç«™ favicon */
        .google-login-container {
            position: relative;
        }

        .google-login-btn {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .google-login-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .google-login-btn.authenticated {
            background: rgba(66, 133, 244, 0.3);
            border-color: rgba(66, 133, 244, 0.6);
        }

        .google-icon {
            width: 16px;
            height: 16px;
            border-radius: 2px;
        }

        .google-login-menu {
            position: absolute;
            top: 45px;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 100;
            display: none;
            min-width: 180px;
            backdrop-filter: blur(10px);
        }

        .google-login-menu::after {
            content: '';
            position: absolute;
            top: -8px;
            right: 15px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(255, 255, 255, 0.95);
        }

        .login-menu-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .login-menu-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .login-menu-item i {
            width: 20px;
            margin-right: 10px;
            font-size: 0.9rem;
        }

        /* å³ä¸‹è§’é½’è¼ªåœ–æ¨™ - æ”¹ç‚ºç°ç©ºé¢¨æ ¼ï¼Œç„¡èƒŒæ™¯ç„¡é‚Šæ¡† */
        .settings-gear {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10;
            cursor: pointer;
            font-size: 1.6rem;
            color: white;
            transition: all 0.3s ease;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background: none;
            backdrop-filter: none;
            border: none;
            border-radius: 0;
            width: auto;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
        }

        .settings-gear:hover {
            transform: rotate(90deg);
            opacity: 1;
            background: none;
            border-color: transparent;
        }

        /* è¨­å®šé¸å–® */
        .settings-menu {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 100;
            display: none;
            min-width: 200px;
            backdrop-filter: blur(10px);
        }

        .settings-menu::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 15px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(255, 255, 255, 0.95);
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }

        .menu-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .menu-item:last-child {
            margin-bottom: 0;
        }

        .menu-item i {
            width: 20px;
            margin-right: 10px;
            font-size: 1rem;
        }

        .menu-item span {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ä¸Šå‚³å®¹å™¨ */
        .video-upload-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .upload-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            position: relative;
            min-width: 450px;
            color: #333;
            text-align: center;
            backdrop-filter: blur(20px);
        }

        .upload-box h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .upload-options {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .cloud-upload-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            flex: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .cloud-upload-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }

        .cloud-upload-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .file-input-wrapper {
            margin: 20px 0;
        }

        .file-input {
            width: 100%;
            padding: 12px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input:hover {
            border-color: #4a6cf7;
            background: #f0f4ff;
        }

        .file-input:focus {
            outline: none;
            border-color: #4a6cf7;
        }

        .upload-btn {
            background: #4a6cf7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .upload-btn:hover {
            background: #3a5ce5;
        }

        .upload-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .close-upload {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }

        .close-upload:hover {
            color: #333;
        }

        .current-video {
            margin-top: 15px;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #155724;
        }

        .url-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .url-input:focus {
            outline: none;
            border-color: #4a6cf7;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }

        .progress {
            width: 0%;
            height: 100%;
            background: #4a6cf7;
            transition: width 0.3s ease;
        }

        .file-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .upload-status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: none;
        }

        .upload-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .upload-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .storage-info {
            font-size: 0.7rem;
            color: #666;
            margin-top: 5px;
            text-align: center;
        }

        .divider {
            margin: 20px 0;
            text-align: center;
            color: #666;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }

        .login-prompt {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .login-prompt i {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #4285f4;
        }

        /* API è¨­å®šå®¹å™¨ */
        .api-setup-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .setup-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            position: relative;
            min-width: 500px;
            max-width: 600px;
            color: #333;
            backdrop-filter: blur(20px);
        }

        .setup-box h3 {
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .setup-instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4285f4;
        }

        .setup-instructions h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .setup-instructions ol {
            text-align: left;
            font-size: 0.8rem;
            color: #666;
            padding-left: 20px;
            line-height: 1.5;
        }

        .setup-instructions li {
            margin-bottom: 8px;
        }

        .setup-instructions code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .setup-instructions a {
            color: #4285f4;
            text-decoration: none;
        }

        .setup-instructions a:hover {
            text-decoration: underline;
        }

        .form-group {
            text-align: left;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .setup-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .google-status {
            font-size: 0.7rem;
            margin-top: 5px;
            color: #666;
        }

        .google-status.connected {
            color: #34A853;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <video id="video-background" autoplay muted loop>
        <source src="https://assets.mixkit.co/videos/preview/mixkit-white-clouds-passing-by-1152-large.mp4" type="video/mp4">
    </video>
    <div class="overlay"></div>

    <div class="header-container">
        <div class="time-container">
            <div class="clock" id="clock">00:00:00</div>
            <div class="date" id="date">2023å¹´1æœˆ1æ—¥ æ˜ŸæœŸä¸€</div>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" id="search-input" placeholder="æœå°‹ Google æˆ–è¼¸å…¥ç¶²å€">
            </div>
        </div>
    </div>

    <!-- å³ä¸Šè§’å¿«æ·éµ -->
    <div class="quick-links">
        <a href="https://www.google.com/imghp" class="quick-link" target="_blank">åœ–ç‰‡</a>
        <a href="https://mail.google.com" class="quick-link" target="_blank">Gmail</a>
        
        <!-- Google ç™»å…¥æŒ‰éˆ• - ä½¿ç”¨ç¶²ç«™ favicon -->
        <div class="google-login-container">
            <button class="google-login-btn" id="google-login-btn">
                <img src="favicon.ico" class="google-icon" alt="Google">
                <span>Google</span>
            </button>
            <div class="google-login-menu" id="google-login-menu">
                <div class="login-menu-item" id="setup-google-api-btn">
                    <i class="fas fa-cog"></i>
                    <span>è¨­å®š API</span>
                </div>
                <div class="login-menu-item" id="google-drive-picker-btn" style="display: none;">
                    <i class="fab fa-google-drive"></i>
                    <span>é¸æ“‡å½±ç‰‡</span>
                </div>
                <div class="login-menu-item" id="google-logout-btn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>ç™»å‡º</span>
                </div>
            </div>
        </div>
    </div>

    <!-- å³ä¸‹è§’é½’è¼ªåœ–æ¨™ - æ”¹ç‚ºç°ç©ºé¢¨æ ¼ -->
    <div class="settings-gear" id="settings-gear">
        <i class="fas fa-cog"></i>
    </div>

    <!-- è¨­å®šé¸å–® -->
    <div class="settings-menu" id="settings-menu">
        <div class="menu-item" id="play-pause-btn">
            <i class="fas fa-play"></i>
            <span>æ’­æ”¾/æš«åœ</span>
        </div>
        <div class="menu-item" id="mute-btn">
            <i class="fas fa-volume-up"></i>
            <span>éœéŸ³/å–æ¶ˆéœéŸ³</span>
        </div>
        <div class="menu-item" id="upload-video-btn">
            <i class="fas fa-upload"></i>
            <span>ä¸Šå‚³èƒŒæ™¯å½±ç‰‡</span>
        </div>
    </div>

    <!-- å½±ç‰‡ä¸Šå‚³å®¹å™¨ -->
    <div class="video-upload-container" id="video-upload-container">
        <div class="upload-box">
            <button class="close-upload" id="close-upload">
                <i class="fas fa-times"></i>
            </button>
            <h3>ä¸Šå‚³è‡ªè¨‚èƒŒæ™¯å½±ç‰‡</h3>
            
            <!-- é›²ç«¯ä¸Šå‚³é¸é … -->
            <div class="upload-options">
                <button class="cloud-upload-btn google" id="google-drive-btn" disabled>
                    <i class="fab fa-google-drive"></i>
                    Google Drive
                </button>
            </div>

            <div id="google-drive-status" class="google-status">
                è«‹å…ˆè¨­å®š Google API ä¸¦ç™»å…¥
            </div>

            <div class="upload-status" id="upload-status"></div>

            <div class="divider">
                <span>æˆ–ä½¿ç”¨æœ¬åœ°æª”æ¡ˆ</span>
            </div>

            <!-- æœ¬åœ°æª”æ¡ˆä¸Šå‚³ -->
            <div class="file-input-wrapper">
                <input type="file" id="video-file" accept="video/mp4" class="file-input">
                <div class="file-info" id="file-info">
                    æ”¯æ´ MP4 æ ¼å¼ï¼Œæœ€å¤§ 50MB
                </div>
            </div>

            <div class="progress-bar" id="progress-bar">
                <div class="progress" id="progress"></div>
            </div>

            <div style="margin: 20px 0; text-align: center; color: #666;">
                â€” æˆ–è¼¸å…¥ç¶²å€ â€”
            </div>

            <!-- ç¶²å€è¼¸å…¥ -->
            <div>
                <input type="url" id="video-url" class="url-input" placeholder="è¼¸å…¥å½±ç‰‡ç¶²å€ (MP4)">
                <button id="load-url-btn" class="upload-btn">è¼‰å…¥ç¶²å€å½±ç‰‡</button>
            </div>

            <button id="confirm-upload" class="upload-btn" disabled>ç¢ºèªè¨­å®š</button>

            <div class="current-video" id="current-video-info" style="display: none;">
                ç›®å‰ä½¿ç”¨: <span id="current-video-name">é è¨­å½±ç‰‡</span>
            </div>

            <div class="storage-info">
                ğŸ’¡ ä½¿ç”¨ Google Drive å¯ç²å¾—æœ€ä½³è¼‰å…¥é€Ÿåº¦
            </div>
        </div>
    </div>

    <!-- Google API è¨­å®šå®¹å™¨ -->
    <div class="api-setup-container" id="api-setup-container">
        <div class="setup-box">
            <button class="close-upload" id="close-api-setup">
                <i class="fas fa-times"></i>
            </button>
            <h3>è¨­å®š Google API</h3>
            
            <div class="setup-instructions">
                <h4>å¦‚ä½•å–å¾— Google OAuth ç”¨æˆ¶ç«¯ IDï¼š</h4>
                <ol>
                    <li>è¨ªå• <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                    <li>å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ</li>
                    <li>å•Ÿç”¨ <strong>Google Drive API</strong> å’Œ <strong>Google Picker API</strong></li>
                    <li>å‰å¾€ã€ŒAPI å’Œæœå‹™ã€â†’ã€ŒOAuth åŒæ„ç•«é¢ã€è¨­å®šæ‡‰ç”¨ç¨‹å¼åç¨±</li>
                    <li>å‰å¾€ã€Œæ†‘è­‰ã€â†’ã€Œå»ºç«‹æ†‘è­‰ã€â†’ã€ŒOAuth ç”¨æˆ¶ç«¯ IDã€</li>
                    <li>æ‡‰ç”¨ç¨‹å¼é¡å‹é¸æ“‡ã€Œç¶²é æ‡‰ç”¨ç¨‹å¼ã€</li>
                    <li>åœ¨ã€Œå·²æˆæ¬Šçš„ JavaScript ä¾†æºã€ä¸­æ·»åŠ ï¼š<code>https://ashbery.github.io</code></li>
                    <li>è¤‡è£½ã€Œç”¨æˆ¶ç«¯ IDã€ä¸¦è²¼åˆ°ä¸‹æ–¹æ¬„ä½</li>
                </ol>
            </div>

            <div class="form-group">
                <label for="google-client-id">Google OAuth ç”¨æˆ¶ç«¯ IDï¼š</label>
                <input type="text" id="google-client-id" class="url-input" 
                       placeholder="xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com">
                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                    æ ¼å¼æ‡‰ç‚ºï¼šxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com
                </div>
            </div>

            <div class="setup-actions">
                <button id="save-api-config" class="upload-btn">å„²å­˜è¨­å®š</button>
                <button id="cancel-api-config" class="upload-btn btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ™‚é˜åŠŸèƒ½
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('zh-TW');
            const date = now.toLocaleDateString('zh-TW', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            
            document.getElementById('clock').textContent = time;
            document.getElementById('date').textContent = date;
        }

        updateClock();
        setInterval(updateClock, 1000);

        // æœå°‹åŠŸèƒ½
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.trim();
                if (query) {
                    if (query.includes('.') || query.includes('://')) {
                        window.location.href = query.includes('://') ? query : 'https://' + query;
                    } else {
                        window.location.href = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                    }
                }
            }
        });

        // å½±ç‰‡æ§åˆ¶
        const video = document.getElementById('video-background');
        const uploadContainer = document.getElementById('video-upload-container');
        const settingsMenu = document.getElementById('settings-menu');
        const settingsGear = document.getElementById('settings-gear');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const uploadStatus = document.getElementById('upload-status');
        const apiSetupContainer = document.getElementById('api-setup-container');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const googleLoginMenu = document.getElementById('google-login-menu');
        
        let selectedFile = null;
        let selectedVideoUrl = '';
        let cloudVideoUrl = '';
        let googleUser = null;
        let googleConfig = null;

        // Google API è¨­å®šç®¡ç†
        class GoogleAPIConfig {
            constructor() {
                this.clientId = localStorage.getItem('google_client_id');
                this.tokenClient = null;
                this.gapiInited = false;
                this.gisInited = false;
                
                // è¼‰å…¥ä¿å­˜çš„ç™»å…¥ç‹€æ…‹
                const savedAuth = localStorage.getItem('google_auth');
                if (savedAuth) {
                    try {
                        googleUser = JSON.parse(savedAuth);
                        console.log('è¼‰å…¥å·²ä¿å­˜çš„ç™»å…¥ç‹€æ…‹');
                    } catch (e) {
                        console.error('è¼‰å…¥ç™»å…¥ç‹€æ…‹å¤±æ•—:', e);
                        localStorage.removeItem('google_auth');
                    }
                }
                
                if (this.clientId) {
                    this.initGoogleAPI();
                }
            }

            // æª¢æŸ¥æ˜¯å¦å·²è¨­å®š
            isConfigured() {
                return !!this.clientId;
            }

            // å„²å­˜ç”¨æˆ¶ç«¯ ID
            saveClientId(clientId) {
                if (clientId && clientId.includes('.apps.googleusercontent.com')) {
                    this.clientId = clientId;
                    localStorage.setItem('google_client_id', clientId);
                    this.initGoogleAPI();
                    return true;
                }
                return false;
            }

            // å–å¾—ç”¨æˆ¶ç«¯ ID
            getClientId() {
                return this.clientId;
            }

            // åˆå§‹åŒ– Google API
            async initGoogleAPI() {
                if (!this.clientId) return;

                // è¼‰å…¥ GAPI
                await new Promise((resolve) => {
                    gapi.load('client:picker', () => {
                        this.gapiInited = true;
                        console.log('GAPI è¼‰å…¥å®Œæˆ');
                        this.initTokenClient();
                        resolve();
                    });
                });
            }

            // åˆå§‹åŒ– Token Client
            initTokenClient() {
                if (!this.clientId) return;

                this.tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: this.clientId,
                    scope: 'https://www.googleapis.com/auth/drive.readonly',
                    callback: (response) => {
                        if (response.error !== undefined) {
                            showUploadStatus('Google æˆæ¬Šå¤±æ•—: ' + response.error, 'error');
                            return;
                        }
                        this.handleAuthSuccess(response.access_token);
                    },
                });

                this.gisInited = true;
                this.updateUI();
            }

            // è™•ç†ç™»å…¥æˆåŠŸ
            handleAuthSuccess(accessToken) {
                const authData = {
                    accessToken: accessToken,
                    timestamp: Date.now()
                };
                googleUser = authData;
                
                // ä¿å­˜ç™»å…¥ç‹€æ…‹
                localStorage.setItem('google_auth', JSON.stringify(authData));
                
                this.updateUI();
                this.initializePicker();
                showUploadStatus('Google å¸³è™Ÿç™»å…¥æˆåŠŸï¼', 'success');
            }

            // æª¢æŸ¥ token æ˜¯å¦éæœŸ (1å°æ™‚)
            isTokenExpired() {
                if (!googleUser || !googleUser.timestamp) return true;
                const oneHour = 60 * 60 * 1000;
                return (Date.now() - googleUser.timestamp) > oneHour;
            }

            // æ›´æ–° UI ç‹€æ…‹
            updateUI() {
                const isConfigured = this.isConfigured();
                const isAuthenticated = !!googleUser && !this.isTokenExpired();

                // å¦‚æœ token éæœŸï¼Œæ¸…é™¤ç™»å…¥ç‹€æ…‹
                if (googleUser && this.isTokenExpired()) {
                    console.log('Token å·²éæœŸï¼Œè‡ªå‹•ç™»å‡º');
                    this.logout();
                    return;
                }

                // æ›´æ–°å³ä¸Šè§’æŒ‰éˆ•
                if (isAuthenticated) {
                    googleLoginBtn.classList.add('authenticated');
                    googleLoginBtn.innerHTML = '<img src="favicon.ico" class="google-icon" alt="Google"><span>å·²é€£ç·š</span>';
                } else {
                    googleLoginBtn.classList.remove('authenticated');
                    googleLoginBtn.innerHTML = '<img src="favicon.ico" class="google-icon" alt="Google"><span>Google</span>';
                }

                // æ›´æ–°é¸å–®é …ç›®
                document.getElementById('google-drive-picker-btn').style.display = isAuthenticated ? 'flex' : 'none';
                document.getElementById('google-logout-btn').style.display = isAuthenticated ? 'flex' : 'none';

                // æ›´æ–°ä¸Šå‚³è¦–çª—ä¸­çš„ç‹€æ…‹
                const driveBtn = document.getElementById('google-drive-btn');
                const statusText = document.getElementById('google-drive-status');
                
                if (isAuthenticated) {
                    driveBtn.disabled = false;
                    statusText.textContent = 'âœ“ Google Drive å·²é€£ç·š';
                    statusText.className = 'google-status connected';
                } else if (isConfigured) {
                    driveBtn.disabled = true;
                    statusText.textContent = 'è«‹é»æ“Šå³ä¸Šè§’ Google æŒ‰éˆ•ç™»å…¥';
                    statusText.className = 'google-status';
                } else {
                    driveBtn.disabled = true;
                    statusText.textContent = 'è«‹å…ˆè¨­å®š Google API';
                    statusText.className = 'google-status';
                }
            }

            // åˆå§‹åŒ– Picker
            async initializePicker() {
                if (!this.gapiInited) return;
                
                try {
                    await gapi.client.init({});
                    console.log('Google Picker åˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('Picker åˆå§‹åŒ–å¤±æ•—:', error);
                }
            }

            // é–‹å•Ÿ Google Drive é¸æ“‡å™¨ - ä¿®æ”¹å¾Œçš„ç‰ˆæœ¬
            async openGoogleDrivePicker() {
                if (!googleUser || !googleUser.accessToken) {
                    throw new Error('è«‹å…ˆç™»å…¥ Google å¸³è™Ÿ');
                }

                if (!this.gapiInited) {
                    throw new Error('Google API å°šæœªåˆå§‹åŒ–å®Œæˆ');
                }

                return new Promise((resolve, reject) => {
                    const view = new google.picker.View(google.picker.ViewId.DOCS);
                    view.setMimeTypes('video/mp4');
                    
                    const picker = new google.picker.PickerBuilder()
                        .setAppId(this.clientId)
                        .setOAuthToken(googleUser.accessToken)
                        .addView(view)
                        .setCallback((data) => {
                            if (data[google.picker.Response.ACTION] === google.picker.Action.PICKED) {
                                const doc = data[google.picker.Response.DOCUMENTS][0];
                                const fileId = doc[google.picker.Document.ID];
                                
                                console.log('é¸æ“‡çš„æª”æ¡ˆ:', doc);
                                
                                // ä½¿ç”¨ Google Drive API URL
                                const videoUrl = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;
                                
                                console.log('ç”Ÿæˆçš„å½±ç‰‡ URL:', videoUrl);
                                
                                resolve({
                                    url: videoUrl,
                                    name: doc.name,
                                    id: fileId,
                                    accessToken: googleUser.accessToken
                                });
                            } else if (data[google.picker.Response.ACTION] === google.picker.Action.CANCEL) {
                                reject(new Error('ç”¨æˆ¶å–æ¶ˆé¸æ“‡'));
                            }
                        })
                        .build();
                    
                    picker.setVisible(true);
                });
            }

            // è«‹æ±‚æˆæ¬Š
            requestAuth() {
                if (this.tokenClient) {
                    this.tokenClient.requestAccessToken();
                } else {
                    showUploadStatus('Google API å°šæœªæº–å‚™å¥½', 'error');
                }
            }

            // ç™»å‡º
            logout() {
                if (googleUser && googleUser.accessToken) {
                    google.accounts.oauth2.revoke(googleUser.accessToken, () => {
                        console.log('Access token å·²æ’¤éŠ·');
                    });
                }
                
                googleUser = null;
                localStorage.removeItem('google_auth');
                this.updateUI();
                showUploadStatus('å·²ç™»å‡º Google å¸³è™Ÿ', 'info');
            }
        }

        // é¡¯ç¤ºä¸Šå‚³ç‹€æ…‹
        function showUploadStatus(message, type = 'info') {
            uploadStatus.textContent = message;
            uploadStatus.className = 'upload-status';
            uploadStatus.classList.add(type);
            uploadStatus.style.display = 'block';
            
            setTimeout(() => {
                uploadStatus.style.display = 'none';
            }, 3000);
        }

        // æ›´æ–°é€²åº¦æ¢
        function updateProgress(percent) {
            progressBar.style.display = 'block';
            progress.style.width = percent + '%';
        }

        // éš±è—é€²åº¦æ¢
        function hideProgress() {
            progressBar.style.display = 'none';
            progress.style.width = '0%';
        }

        // Google ç™»å…¥æŒ‰éˆ•é»æ“Š
        googleLoginBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            if (googleConfig && googleConfig.isConfigured()) {
                if (googleUser && !googleConfig.isTokenExpired()) {
                    googleLoginMenu.style.display = googleLoginMenu.style.display === 'block' ? 'none' : 'block';
                } else {
                    googleConfig.requestAuth();
                }
            } else {
                showAPISetupPrompt();
            }
        });

        // é»æ“Šé é¢å…¶ä»–å€åŸŸé—œé–‰é¸å–®
        document.addEventListener('click', function(e) {
            if (!googleLoginBtn.contains(e.target) && !googleLoginMenu.contains(e.target)) {
                googleLoginMenu.style.display = 'none';
            }
            if (!settingsGear.contains(e.target) && !settingsMenu.contains(e.target)) {
                settingsMenu.style.display = 'none';
            }
        });

        // Google API è¨­å®šæŒ‰éˆ•
        document.getElementById('setup-google-api-btn').addEventListener('click', function() {
            showAPISetupPrompt();
            googleLoginMenu.style.display = 'none';
        });

        // Google Drive é¸æ“‡å™¨æŒ‰éˆ•
        document.getElementById('google-drive-picker-btn').addEventListener('click', async function() {
            await openGoogleDrivePicker();
            googleLoginMenu.style.display = 'none';
        });

        // Google ç™»å‡ºæŒ‰éˆ•
        document.getElementById('google-logout-btn').addEventListener('click', function() {
            googleConfig.logout();
            googleLoginMenu.style.display = 'none';
        });

        // é¡¯ç¤º API è¨­å®šæç¤º
        function showAPISetupPrompt() {
            apiSetupContainer.style.display = 'flex';
            if (googleConfig) {
                const savedClientId = googleConfig.getClientId();
                if (savedClientId) {
                    document.getElementById('google-client-id').value = savedClientId;
                }
            }
        }

        // é—œé–‰ API è¨­å®š
        document.getElementById('close-api-setup').addEventListener('click', function() {
            apiSetupContainer.style.display = 'none';
        });

        document.getElementById('cancel-api-config').addEventListener('click', function() {
            apiSetupContainer.style.display = 'none';
        });

        // å„²å­˜ API è¨­å®š
        document.getElementById('save-api-config').addEventListener('click', function() {
            const clientId = document.getElementById('google-client-id').value.trim();
            if (googleConfig.saveClientId(clientId)) {
                showUploadStatus('Google API è¨­å®šæˆåŠŸï¼', 'success');
                apiSetupContainer.style.display = 'none';
            } else {
                showUploadStatus('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Google OAuth ç”¨æˆ¶ç«¯ ID', 'error');
            }
        });

        // Google Drive é¸æ“‡å™¨ - å¤–éƒ¨å‡½æ•¸
        async function openGoogleDrivePicker() {
            const btn = document.getElementById('google-drive-btn');
            btn.disabled = true;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è¼‰å…¥ä¸­...';

            try {
                const driveFile = await googleConfig.openGoogleDrivePicker();
                cloudVideoUrl = driveFile.url;
                selectedFile = null;
                selectedVideoUrl = '';
                
                document.getElementById('confirm-upload').disabled = false;
                document.getElementById('file-info').textContent = `å·²é¸æ“‡: ${driveFile.name}`;
                showUploadStatus('Google Drive å½±ç‰‡é¸æ“‡æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('Google Drive é¸æ“‡å¤±æ•—:', error);
                showUploadStatus(`Google Drive é¸æ“‡å¤±æ•—: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fab fa-google-drive"></i> Google Drive';
            }
        }

        // é½’è¼ªé»æ“Šäº‹ä»¶
        settingsGear.addEventListener('click', function(e) {
            e.stopPropagation();
            settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });

        // æ’­æ”¾/æš«åœ
        document.getElementById('play-pause-btn').addEventListener('click', function() {
            if (video.paused) {
                video.play();
                this.innerHTML = '<i class="fas fa-pause"></i><span>æš«åœå½±ç‰‡</span>';
            } else {
                video.pause();
                this.innerHTML = '<i class="fas fa-play"></i><span>æ’­æ”¾å½±ç‰‡</span>';
            }
            settingsMenu.style.display = 'none';
        });

        // éœéŸ³/å–æ¶ˆéœéŸ³
        document.getElementById('mute-btn').addEventListener('click', function() {
            video.muted = !video.muted;
            this.innerHTML = video.muted ? 
                '<i class="fas fa-volume-mute"></i><span>å–æ¶ˆéœéŸ³</span>' : 
                '<i class="fas fa-volume-up"></i><span>éœéŸ³å½±ç‰‡</span>';
            settingsMenu.style.display = 'none';
        });

        // ä¸Šå‚³å½±ç‰‡ä»‹é¢
        document.getElementById('upload-video-btn').addEventListener('click', function() {
            uploadContainer.style.display = 'flex';
            settingsMenu.style.display = 'none';
            resetUploadForm();
        });

        document.getElementById('close-upload').addEventListener('click', function() {
            uploadContainer.style.display = 'none';
            resetUploadForm();
        });

        // Google Drive æŒ‰éˆ• (ä¸Šå‚³è¦–çª—å…§)
        document.getElementById('google-drive-btn').addEventListener('click', openGoogleDrivePicker);

        // æª”æ¡ˆé¸æ“‡
        document.getElementById('video-file').addEventListener('change', function(e) {
            selectedFile = e.target.files[0];
            cloudVideoUrl = '';
            selectedVideoUrl = '';
            document.getElementById('video-url').value = '';
            
            if (selectedFile) {
                if (selectedFile.type !== 'video/mp4') {
                    showUploadStatus('è«‹é¸æ“‡ MP4 æ ¼å¼çš„å½±ç‰‡æª”æ¡ˆ', 'error');
                    resetUploadForm();
                    return;
                }
                
                if (selectedFile.size > 50 * 1024 * 1024) {
                    showUploadStatus('æª”æ¡ˆå¤ªå¤§ï¼è«‹é¸æ“‡å°æ–¼ 50MB çš„å½±ç‰‡', 'error');
                    resetUploadForm();
                    return;
                }
                
                document.getElementById('confirm-upload').disabled = false;
                document.getElementById('file-info').textContent = 
                    `å·²é¸æ“‡: ${selectedFile.name} (${(selectedFile.size / 1024 / 1024).toFixed(2)} MB)`;
            } else {
                document.getElementById('confirm-upload').disabled = true;
            }
        });

        // ç¶²å€è¼‰å…¥
        document.getElementById('load-url-btn').addEventListener('click', function() {
            const url = document.getElementById('video-url').value.trim();
            if (url) {
                selectedVideoUrl = url;
                cloudVideoUrl = '';
                selectedFile = null;
                document.getElementById('video-file').value = '';
                document.getElementById('confirm-upload').disabled = false;
                document.getElementById('file-info').textContent = 'å·²è¼¸å…¥ç¶²å€å½±ç‰‡';
                showUploadStatus('ç¶²å€å½±ç‰‡è¨­å®šæˆåŠŸï¼', 'success');
            } else {
                showUploadStatus('è«‹è¼¸å…¥å½±ç‰‡ç¶²å€', 'error');
            }
        });

        // é‡ç½®ä¸Šå‚³è¡¨å–®
        function resetUploadForm() {
            selectedFile = null;
            selectedVideoUrl = '';
            cloudVideoUrl = '';
            document.getElementById('video-file').value = '';
            document.getElementById('video-url').value = '';
            document.getElementById('confirm-upload').disabled = true;
            hideProgress();
            document.getElementById('file-info').textContent = 'æ”¯æ´ MP4 æ ¼å¼ï¼Œæœ€å¤§ 50MB';
            
            const confirmBtn = document.getElementById('confirm-upload');
            confirmBtn.innerHTML = 'ç¢ºèªè¨­å®š';
            confirmBtn.disabled = true;
        }

        // ç¢ºèªè¨­å®š - ä¿®æ”¹ç‚ºä½¿ç”¨ fetch è¼‰å…¥ Google Drive å½±ç‰‡
        document.getElementById('confirm-upload').addEventListener('click', async function() {
            const confirmBtn = this;
            confirmBtn.disabled = true;
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è¨­å®šä¸­...';

            try {
                let videoUrl;
                let videoName;

                if (cloudVideoUrl) {
                    // ä½¿ç”¨é›²ç«¯å½±ç‰‡ - ä½¿ç”¨ fetch è¼‰å…¥
                    console.log('é–‹å§‹è¼‰å…¥ Google Drive å½±ç‰‡...');
                    
                    const response = await fetch(cloudVideoUrl, {
                        headers: {
                            'Authorization': `Bearer ${googleUser.accessToken}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const blob = await response.blob();
                    videoUrl = URL.createObjectURL(blob);
                    videoName = 'Google Drive å½±ç‰‡';
                    
                    console.log('âœ… å½±ç‰‡è¼‰å…¥æˆåŠŸï¼Œå¤§å°:', (blob.size / 1024 / 1024).toFixed(2), 'MB');
                    
                    // ä¿å­˜åˆ°æ“´å……åŠŸèƒ½
                    if (window.extensionHelper) {
                        try {
                            await window.extensionHelper.saveCloudVideo(cloudVideoUrl, 'Google Drive å½±ç‰‡');
                            console.log('é›²ç«¯å½±ç‰‡è³‡è¨Šå·²ä¿å­˜åˆ°æ“´å……åŠŸèƒ½');
                        } catch (error) {
                            console.log('æ“´å……åŠŸèƒ½ä¿å­˜å¤±æ•—:', error);
                        }
                    }
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å„²å­˜
                    saveCloudVideoInfo(cloudVideoUrl, 'Google Drive å½±ç‰‡', 'google_drive');
                    
                } else if (selectedFile) {
                    // ä½¿ç”¨æœ¬åœ°æª”æ¡ˆ (å»ºç«‹ blob URL)
                    const blob = new Blob([selectedFile], { type: selectedFile.type });
                    videoUrl = URL.createObjectURL(blob);
                    videoName = selectedFile.name;
                    
                    // ä¿å­˜åˆ°æ“´å……åŠŸèƒ½
                    if (window.extensionHelper) {
                        try {
                            await window.extensionHelper.saveVideo(selectedFile);
                        } catch (error) {
                            console.log('æ“´å……åŠŸèƒ½ä¿å­˜å¤±æ•—:', error);
                        }
                    }
                    
                } else if (selectedVideoUrl) {
                    // ä½¿ç”¨ç¶²å€å½±ç‰‡
                    videoUrl = selectedVideoUrl;
                    videoName = 'è‡ªè¨‚ç¶²å€å½±ç‰‡';
                    localStorage.setItem('videoUrl', selectedVideoUrl);
                }

                if (videoUrl) {
                    video.src = videoUrl;
                    video.play();
                    updateCurrentVideoInfo(videoName);
                    
                    showUploadStatus('å½±ç‰‡è¨­å®šæˆåŠŸï¼', 'success');
                    
                    setTimeout(() => {
                        uploadContainer.style.display = 'none';
                        resetUploadForm();
                    }, 1500);
                } else {
                    throw new Error('æ²’æœ‰é¸æ“‡æœ‰æ•ˆçš„å½±ç‰‡ä¾†æº');
                }
                
            } catch (error) {
                console.error('è¨­å®šå¤±æ•—:', error);
                showUploadStatus(`è¨­å®šå¤±æ•—: ${error.message}`, 'error');
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            }
        });

        // ä¿å­˜é›²ç«¯å½±ç‰‡è³‡è¨Š
        function saveCloudVideoInfo(url, name, type) {
            const videoInfo = {
                url: url,
                name: name,
                type: type,
                timestamp: Date.now(),
                source: 'cloud'
            };
            localStorage.setItem('cloudVideoInfo', JSON.stringify(videoInfo));
        }

        // è¼‰å…¥é›²ç«¯å½±ç‰‡è³‡è¨Š
        function loadCloudVideoInfo() {
            const saved = localStorage.getItem('cloudVideoInfo');
            return saved ? JSON.parse(saved) : null;
        }

        function updateCurrentVideoInfo(name) {
            document.getElementById('current-video-info').style.display = 'block';
            document.getElementById('current-video-name').textContent = name;
        }

        // æ™ºæ…§è¼‰å…¥å½±ç‰‡ - æ”¯æ´ Google Drive fetch è¼‰å…¥
        async function loadVideo() {
            // 1. å„ªå…ˆå¾æ“´å……åŠŸèƒ½è¼‰å…¥
            if (window.extensionHelper) {
                try {
                    const savedData = await window.extensionHelper.loadVideo();
                    console.log('å¾æ“´å……åŠŸèƒ½è¼‰å…¥è³‡æ–™:', savedData);
                    
                    // å„ªå…ˆè¼‰å…¥é›²ç«¯å½±ç‰‡
                    if (savedData.cloudVideo && googleUser && googleUser.accessToken) {
                        try {
                            console.log('å˜—è©¦è¼‰å…¥ Google Drive å½±ç‰‡...');
                            const response = await fetch(savedData.cloudVideo.url, {
                                headers: {
                                    'Authorization': `Bearer ${googleUser.accessToken}`
                                }
                            });
                            
                            if (response.ok) {
                                const blob = await response.blob();
                                const blobUrl = URL.createObjectURL(blob);
                                video.src = blobUrl;
                                updateCurrentVideoInfo(savedData.cloudVideo.name || 'é›²ç«¯å½±ç‰‡');
                                console.log('âœ… å¾æ“´å……åŠŸèƒ½è¼‰å…¥é›²ç«¯å½±ç‰‡æˆåŠŸ');
                                return true;
                            } else {
                                console.warn('Google Drive å½±ç‰‡è¼‰å…¥å¤±æ•—ï¼Œç‹€æ…‹ç¢¼:', response.status);
                            }
                        } catch (error) {
                            console.warn('Google Drive å½±ç‰‡è¼‰å…¥å¤±æ•—:', error);
                        }
                    }
                    
                    // å…¶æ¬¡è¼‰å…¥æœ¬åœ°å½±ç‰‡
                    if (savedData.customVideo) {
                        try {
                            let videoData = savedData.customVideo;
                            if (!videoData.startsWith('data:')) {
                                videoData = `data:video/mp4;base64,${videoData}`;
                            }
                            video.src = videoData;
                            updateCurrentVideoInfo(savedData.videoName || 'è‡ªè¨‚å½±ç‰‡');
                            console.log('å¾æ“´å……åŠŸèƒ½è¼‰å…¥æœ¬åœ°å½±ç‰‡');
                            return true;
                        } catch (error) {
                            console.warn('æ“´å……åŠŸèƒ½æœ¬åœ°å½±ç‰‡è¼‰å…¥å¤±æ•—:', error);
                        }
                    }
                } catch (error) {
                    console.log('æ“´å……åŠŸèƒ½è¼‰å…¥å¤±æ•—:', error);
                }
            }

            // 2. å˜—è©¦è¼‰å…¥æœ¬åœ°å„²å­˜çš„é›²ç«¯å½±ç‰‡
            const cloudVideo = loadCloudVideoInfo();
            if (cloudVideo && cloudVideo.url && googleUser && googleUser.accessToken) {
                try {
                    console.log('å˜—è©¦å¾æœ¬åœ°å„²å­˜è¼‰å…¥ Google Drive å½±ç‰‡...');
                    const response = await fetch(cloudVideo.url, {
                        headers: {
                            'Authorization': `Bearer ${googleUser.accessToken}`
                        }
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const blobUrl = URL.createObjectURL(blob);
                        video.src = blobUrl;
                        updateCurrentVideoInfo(cloudVideo.name || 'é›²ç«¯å½±ç‰‡');
                        console.log('âœ… å¾æœ¬åœ°å„²å­˜è¼‰å…¥é›²ç«¯å½±ç‰‡æˆåŠŸ');
                        return true;
                    } else {
                        console.warn('æœ¬åœ°å„²å­˜å½±ç‰‡è¼‰å…¥å¤±æ•—ï¼Œç‹€æ…‹ç¢¼:', response.status);
                    }
                } catch (error) {
                    console.warn('æœ¬åœ°é›²ç«¯å½±ç‰‡è¼‰å…¥å¤±æ•—:', error);
                }
            }

            // 3. å˜—è©¦è¼‰å…¥ç¶²å€å½±ç‰‡
            const videoUrl = localStorage.getItem('videoUrl');
            if (videoUrl) {
                video.src = videoUrl;
                updateCurrentVideoInfo('è‡ªè¨‚ç¶²å€å½±ç‰‡');
                return true;
            }

            // 4. ä½¿ç”¨é è¨­å½±ç‰‡
            updateCurrentVideoInfo('é è¨­å½±ç‰‡');
            return false;
        }

        // é é¢è¼‰å…¥
        window.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ– Google API è¨­å®šç®¡ç†å™¨
            googleConfig = new GoogleAPIConfig();

            loadVideo();
            video.play();
            searchInput.focus();
        });

        // æ¸…ç† blob URL
        window.addEventListener('beforeunload', function() {
            if (video.src && video.src.startsWith('blob:')) {
                URL.revokeObjectURL(video.src);
            }
        });
    </script>
</body>
</html>
